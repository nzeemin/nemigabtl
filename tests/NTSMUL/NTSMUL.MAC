	.TITLE	NTSMUL
	.MCall	.EXIT, .PRINT, .TTYOUT, .TTYIN

.MACRO	PUSH	RR
	MOV	RR,-(SP)
.ENDM
.MACRO	POP	RR
	MOV	(SP)+,RR
.ENDM

	.ASECT
	.=001000
START::
	.PRINT	#TITLE

; Printing table for MUL
	MOV	#<<DATAEND-DATA>/4>, R5
	MOV	#DATA, R4
1$:	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	MOV	(R4)+, R1
	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	MOV	(R4)+, R0
	MUL	R1, R0
	MFPS	R3		; Сохраняем флаги MUL
	PUSH	170004
	PUSH	170002
	PUSH	170000
	CALL	BTOA
	CALL	PRISP
	MOV	R1, R0
	CALL	BTOA
	CALL	PRISP
	MOV	R3, R0		; Берём флаги MUL
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	POP	R0		; 170000
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170002
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170004
	CALL	BTOA
	CALL	PRISP
	CALL	PRINL
	SOB	R5, 1$

	CALL	NEXTPG

; Printing table for DIV
	.PRINT	#TITLE2
	MOV	#<<DATAEND-DATA>/4>, R5
	MOV	#DATA, R4
2$:	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	MOV	(R4)+, R1
	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	MOV	(R4)+, R0
	DIV	R1, R0
	MFPS	R3		; Сохраняем флаги MUL
	PUSH	170004
	PUSH	170002
	PUSH	170000
	CALL	BTOA
	CALL	PRISP
	MOV	R1, R0
	CALL	BTOA
	CALL	PRISP
	MOV	R3, R0		; Берём флаги MUL
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	POP	R0		; 170000
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170002
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170004
	CALL	BTOA
	CALL	PRISP
	CALL	PRINL
	SOB	R5, 2$

	CALL	NEXTPG

; Printing table for ASH
	.PRINT	#TITLE3
	MOV	#<<DATAEND-DATA>/4>, R5
	MOV	#DATA, R4
3$:	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	MOV	(R4)+, R1
	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	MOV	(R4)+, R0
	ASH	R1, R0
	MFPS	R3		; Сохраняем флаги MUL
	PUSH	170004
	PUSH	170002
	PUSH	170000
	CALL	BTOA
	CALL	PRISP
	MOV	R1, R0
	CALL	BTOA
	CALL	PRISP
	MOV	R3, R0		; Берём флаги MUL
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	POP	R0		; 170000
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170002
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170004
	CALL	BTOA
	CALL	PRISP
	CALL	PRINL
	SOB	R5, 3$

	CALL	NEXTPG

; Printing table for ASHC
	.PRINT	#TITLE4
	MOV	#<<DATAEND-DATA>/4>, R5
	MOV	#DATA, R4
4$:	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	MOV	(R4)+, R1
	MOV	(R4), R0
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	MOV	(R4)+, R0
	ASHC	R1, R0
	MFPS	R3		; Сохраняем флаги MUL
	PUSH	170004
	PUSH	170002
	PUSH	170000
	CALL	BTOA
	CALL	PRISP
	MOV	R1, R0
	CALL	BTOA
	CALL	PRISP
	MOV	R3, R0		; Берём флаги MUL
	CALL	BTOA
	CALL	PRISP
	CALL	PRISP
	POP	R0		; 170000
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170002
	CALL	BTOA
	CALL	PRISP
	POP	R0		; 170004
	CALL	BTOA
	CALL	PRISP
	CALL	PRINL
	SOB	R5, 4$
	
	.EXIT

TITLE:	.ASCII	/NTSMUL v0.2/<015><012>
	.ASCIZ	/A      B       MUL A,B        flags  170000 170002 170004/
TITLE2:	.ASCIZ	/A      B       DIV A,B        flags  170000 170002 170004/
TITLE3:	.ASCIZ	/A      B       ASH A,B        flags  170000 170002 170004/
TITLE4:	.ASCIZ	/A      B       ASHC A,B       flags  170000 170002 170004/
NEXTPT:	.ASCIZ	/next?/
	.EVEN
DATA:
	.WORD	000000, 000000
	.WORD	000001, 000001
	.WORD	000010, 000020
	.WORD	077777, 000001
	.WORD	000001, 077777
	.WORD	077777, 077777
	.WORD	177777, 077777
	.WORD	077777, 177777
	.WORD	177777, 177777
DATAEND:

NEXTPG:	.PRINT	#NEXTPT
1$:	.TTYIN
	CMP	#12, R0
	BNE	1$
	RETURN

PRINL:	.PRINT	#LF
	RETURN
LF:	.ASCIZ	<015>
PRISP:
	MOV	#040, R0
	.TTYOUT
	RETURN

BTOA:	PUSH	R1
	PUSH	R2
	MOV	#<BTOAS+6>, R2
	MOV	#6, R1
1$:	PUSH	R0
	BIC	#177770,R0
	ADD	#'0, R0
	MOVB	R0, -(R2)
	POP	R0
	CLC
	ROR	R0
	ASR	R0
	ASR	R0
	SOB	R1, 1$
	.PRINT	#BTOAS
	POP	R2
	POP	R1
	RETURN	
BTOAS:	.ASCII	/000000/<200>
	.EVEN

STACK:	.BLKW	100			; Под стек

	.END	START
